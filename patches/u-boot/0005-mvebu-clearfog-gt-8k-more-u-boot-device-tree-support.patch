From 18126243465b2b7db37bd5645c22dbb39e5d5960 Mon Sep 17 00:00:00 2001
From: Rabeeh Khoury <rabeeh@solid-run.com>
Date: Thu, 15 Feb 2018 23:29:46 +0200
Subject: [PATCH] mvebu: clearfog gt 8k - more u-boot device tree support

Signed-off-by: Rabeeh Khoury <rabeeh@solid-run.com>
---
 arch/arm/dts/armada-8040-cf-gt-8k.dts |   55 ++++++++++++++++++++++++++++-----
 1 file changed, 47 insertions(+), 8 deletions(-)

diff --git a/arch/arm/dts/armada-8040-cf-gt-8k.dts b/arch/arm/dts/armada-8040-cf-gt-8k.dts
index 17827aa..04dd494 100644
--- a/arch/arm/dts/armada-8040-cf-gt-8k.dts
+++ b/arch/arm/dts/armada-8040-cf-gt-8k.dts
@@ -21,9 +21,13 @@
 		i2c0 = &cpm_i2c0;
 		i2c1 = &cpm_i2c1;
 		spi0 = &cps_spi1;
-		gpio0 = &ap_gpio0;
-		gpio1 = &cpm_gpio0;
-		gpio2 = &cpm_gpio1;
+		fuse0 = &ap_hd_efuse0;
+		fuse1 = &ap_ld_efuse0;
+		fuse2 = &ap_ld_efuse1;
+		fuse3 = &cpm_ld_efuse0;
+		fuse4 = &cpm_ld_efuse1;
+		fuse5 = &cps_ld_efuse0;
+		fuse6 = &cps_ld_efuse1;
 	};
 
 	memory@00000000 {
@@ -56,6 +60,18 @@
 	status = "okay";
 };
 
+&ap_hd_efuse0 {
+	status = "okay";
+};
+
+&ap_ld_efuse0 {
+	status = "okay";
+};
+
+&ap_ld_efuse1 {
+	status = "okay";
+};
+
 &ap_pinctl {
 	/*
 	 * MPP Bus:
@@ -87,6 +103,7 @@
 	 * [35-38] CP0 I2C1 and I2C0
 	 * [39] GPIO reset button
 	 * [40,41] LED0 and LED1
+	 * [43] 1512 phy reset
 	 * [47] USB VBUS EN (active low)
 	 * [48] FAN PWM
 	 * [49] SFP+ present signal
@@ -97,7 +114,6 @@
 	 * [54] NFC reset
 	 * [55] Micro SD card detect
 	 * [56-61] Micro SD
-	 * [62] 1512 phy reset
 	 */
 		/*   0    1    2    3    4    5    6    7    8    9 */
 	pin-func = < 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff
@@ -106,7 +122,7 @@
 		     0xff 0    0    0    0    2    2    2    2    0
 		     0    0    0    0    0    0    0    0    0    0
 		     0    0    0    0    0    0    0xe  0xe  0xe  0xe
-		     0xe  0xe  0 >;
+		     0xe  0xe  0xe >;
 
 	cpm_xhci_vbus_pins: cpm-xhci-vbus-pins {
 		marvell,pins = < 47 >;
@@ -114,6 +130,15 @@
 	};
 };
 
+&cpm_ld_efuse0 {
+	status = "okay";
+};
+
+&cpm_ld_efuse1 {
+	status = "okay";
+};
+
+
 /* PCIe x4 */
 &cpm_pcie0 {
 	num-lanes = <1>;
@@ -233,11 +258,23 @@
 		/*   0    1    2    3    4    5    6    7    8    9 */
 	pin-func = < 0x4  0x4  0x4  0x4  0x4  0x4  0x0  0x4  0x4  0x4
 		     0x4  0x4  0x0  0x3  0x3  0x3  0x3  0xff 0xff 0xff
-		     0xff 0xff 0xff 0xff 0x0  0xff 0x0  0x8  0x8 0x0
-		     0x0  0x0  0x0 0xff 0xff 0xff 0xff 0xff 0xff 0xff
+		     0xff 0xff 0xff 0xff 0x0  0xff 0x0  0x8  0x8  0x0
+		     0x0  0x0  0x0  0xff 0xff 0xff 0xff 0xff 0xff 0xff
 		     0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff
 		     0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff 0xff
 		     0xff 0xff 0xff>;
+	cps_1g_phy_reset: cps-1g-phy-reset {
+		marvell,pins = < 43 >;
+		marvell,function = <0>;
+	};
+};
+
+&cps_ld_efuse0 {
+	status = "okay";
+};
+
+&cps_ld_efuse1 {
+	status = "okay";
 };
 
 &cps_spi1 {
@@ -281,6 +318,7 @@
 	 */
 	phy0 {
 		phy-type = <COMPHY_TYPE_SATA1>;
+		phy-invert = <COMPHY_POLARITY_RXD_INVERT>;
 	};
 	phy1 {
 		phy-type = <COMPHY_TYPE_UNCONNECTED>;
@@ -309,6 +347,7 @@
 
 &cps_ethernet {
 	pinctrl-names = "default";
+	pinctrl-0 = <&cps_1g_phy_reset>;
 	status = "okay";
 };
 
@@ -317,7 +356,7 @@
 	status = "okay";
 	phy-mode = "sgmii";
 	phy = <&phy0>;
-	phy-reset-gpios = <&cpm_gpio1 30 GPIO_ACTIVE_HIGH>;
+	phy-reset-gpios = <&cpm_gpio1 11 GPIO_ACTIVE_HIGH>;
 };
 
 /* 2.5G to Topaz switch */
-- 
1.7.9.5

